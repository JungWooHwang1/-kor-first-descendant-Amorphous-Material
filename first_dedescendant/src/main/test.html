<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        const weaponNames = [
            "간파하는 자", "검의 잔광", "관통하는 빛", "그렉의 뒤바뀐 운명", "나제스트라의 헌신",
            "복원된 유물", "비단뱀", "비밀정원", "빛의 파도", "산산조각",
            "알비온 기병총", "왕의 수호창", "위대한 유산", "집행자", "천리안",
            "천벌", "청풍뎅이", "최후의 걸작"
        ];

        const weaponResources = ['고분자 융합체', '합성 광섬유', '나노 튜브', '연구 도면', '완성한 개수'];
        const weaponMaxCols = weaponResources.length;

        // 무기와 해당 입력 필드에 매핑될 클래스 이름을 저장하는 객체
        const weaponClasses = weaponNames.reduce((acc, weapon, index) => {
            acc[weapon] = Array.from({ length: weaponMaxCols }, (_, colIndex) => `r${colIndex + 1}c${index + 1}`);
            return acc;
        }, {});

        // 테이블 본문 참조
        const weaponTbody = document.querySelector("#weapon-table tbody");

        // 각 무기와 재료의 행 생성
        weaponNames.forEach((weapon, rowIndex) => {
            const row = document.createElement("tr");

            // 무기 이름 셀 추가
            const weaponCell = document.createElement("td");
            weaponCell.textContent = weapon;
            row.appendChild(weaponCell);

            // 재료 입력란 추가
            for (let colIndex = 1; colIndex <= weaponMaxCols; colIndex++) {
                const inputCell = document.createElement("td");
                const input = document.createElement("input");
                input.type = "number";
                input.min = "0";
                input.max = "5";
                input.className = `r${colIndex}c${rowIndex + 1}`;
                inputCell.appendChild(input);
                row.appendChild(inputCell);
            }

            // 행을 테이블에 추가
            weaponTbody.appendChild(row);
        });

        // 블러 상태를 로컬 스토리지에 저장
        function weaponSaveBlurState() {
            console.log('Saving blur state to local storage');

            const blurredCells = Array.from(document.querySelectorAll('td.blurred')).map(cell => cell.className);
            localStorage.setItem('blurredCells', JSON.stringify(blurredCells));
        }

        // 블러 상태를 로컬 스토리지에서 복원
        function weaponRestoreBlurState() {
            console.log('Restoring blur state from local storage');

            const blurredCells = JSON.parse(localStorage.getItem('blurredCells') || '[]');
            blurredCells.forEach(cellClass => {
                const cell = document.querySelector(`.${cellClass}`);
                if (cell) {
                    cell.classList.add('blurred');
                    cell.style.backgroundColor = '#f0f0f0'; // 배경 색 변경
                }
            });
        }

        // 필드 값 저장
        function weaponSaveToLocalStorage() {
            console.log('Saving data to local storage');

            Object.values(weaponClasses).flat().forEach(cellClass => {
                const input = document.querySelector(`.${cellClass}`);
                if (input) {
                    localStorage.setItem(cellClass, input.value);
                    console.log(`Saved ${cellClass} with value ${input.value}`);
                }
            });

            document.querySelectorAll('input[type="number"].completed').forEach(input => {
                if (input) {
                    localStorage.setItem(input.className, input.value);
                    console.log(`Saved ${input.className} with value ${input.value}`);
                }
            });
        }

        // 필드 값 복원
        function weaponLoadFromLocalStorage() {
            console.log('Loading data from local storage');

            Object.values(weaponClasses).flat().forEach(cellClass => {
                const input = document.querySelector(`.${cellClass}`);
                if (input) {
                    const savedValue = localStorage.getItem(cellClass);
                    if (savedValue) {
                        input.value = savedValue;
                        console.log(`Loaded ${cellClass} with value ${savedValue}`);
                    }
                }
            });

            document.querySelectorAll('input[type="number"].completed').forEach(input => {
                if (input) {
                    const savedValue = localStorage.getItem(input.className);
                    if (savedValue) {
                        input.value = savedValue;
                        console.log(`Loaded ${input.className} with value ${savedValue}`);
                    }
                }
            });
        }

        // 필드 값과 블러 상태를 업데이트
        function weaponCheckAndBlur() {
            console.log('Check and Blur Function Called');

            const table = document.querySelector('table');
            const rows = table.getElementsByTagName('tr');

            // 블러 처리가 필요한 모든 셀 처리
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                for (let j = 0; j < cells.length; j++) {
                    const cell = cells[j];
                    const cellText = cell.textContent.trim();
                    let shouldBlur = false;

                    // 무기와 자원의 블러 처리
                    Object.keys(weaponClasses).forEach(weapon => {
                        if (cellText.includes(weapon)) {
                            weaponResources.forEach((resource, index) => {
                                if (cellText.includes(resource)) {
                                    const inputValue = Number(document.querySelector(`.${weaponClasses[weapon][index]}`).value);
                                    if (inputValue >= 5) {
                                        shouldBlur = true;
                                    }
                                }
                            });
                        }
                    });

                    if (shouldBlur) {
                        cell.classList.add('blurred');
                        cell.style.backgroundColor = '#f0f0f0'; // 배경 색 변경
                        console.log(`Cell ${cell.className} added blurred class and background color`);
                    } else {
                        cell.classList.remove('blurred');
                        cell.style.backgroundColor = ''; // 배경 색 초기화
                        console.log(`Cell ${cell.className} removed blurred class`);
                    }
                }
            }

            // 블러 상태를 로컬 스토리지에 저장
            weaponSaveBlurState();
        }

        // 이벤트 리스너 추가
        Object.values(weaponClasses).flat().forEach(inputClass => {
            const inputs = document.querySelectorAll(`.${inputClass}`);
            inputs.forEach(input => {
                if (input) {
                    input.addEventListener('input', () => {
                        weaponCheckAndBlur();
                        weaponSaveToLocalStorage();
                    });
                    console.log(`Event listener added to input ${input.className}`);
                }
            });
        });

        // '완성한 개수' 입력 필드에 이벤트 리스너 추가
        document.querySelectorAll('input[type="number"].completed').forEach(input => {
            if (input) {
                input.addEventListener('input', () => {
                    weaponCheckAndBlur();
                    weaponSaveToLocalStorage();
                });
                console.log(`Event listener added to completion input ${input.className}`);
            }
        });

        // 페이지 로드 시 상태 복원
        document.addEventListener('DOMContentLoaded', () => {
            weaponLoadFromLocalStorage();
            weaponRestoreBlurState(); // 필드 값 복원 후 블러 상태 복원
            weaponCheckAndBlur(); // 블러 상태를 다시 업데이트
        });
    </script>
    const characterNames = [
    '얼티밋 글레이', '얼티밋 레픽', '얼티밋 버니', '얼티밋 비에사', '얼티밋 밸비', '얼티밋 에이잭스',
    '일반 글레이', '일반 레픽', '일반 밸비', '일반 비에사', '일반 에시모', '일반 에이잭스',
    '일반 엔조', '일반 유진', '일반 제이버', '일반 카일', '일반 루나'
    ];

    const characterParts = ['강화 세포 도면', '안정화 장치 도면', '나선 촉매 도면', '코드'];
    const characterMaxCols = characterParts.length;

    // 캐릭터와 부품을 매핑할 클래스 이름 저장 객체 생성
    const characterCellClasses = characterNames.reduce((acc, character, rowIndex) => {
    acc[character] = Array.from({ length: characterMaxCols }, (_, colIndex) => `character-r${colIndex +
    1}character-c${rowIndex + 1}`);
    return acc;
    }, {});

    const character_tbody = document.querySelector("#character-table tbody");

    characterNames.forEach((character, rowIndex) => {
    const row = document.createElement("tr");

    // 캐릭터 이름 셀 추가
    const characterCell = document.createElement("td");
    characterCell.textContent = character;
    row.appendChild(characterCell);

    // 재료 입력란 추가
    for (let colIndex = 1; colIndex <= characterMaxCols; colIndex++) { const inputCell=document.createElement("td");
        const input=document.createElement("input"); input.type="number" ; input.min="0" ; input.max="1" ;
        input.className=`character-r${colIndex}character-c${rowIndex + 1}`; inputCell.appendChild(input);
        row.appendChild(inputCell); } // 행을 테이블에 추가 character_tbody.appendChild(row); }); // 블러 상태를 로컬 스토리지에 저장 function
        characterSaveBlurState() { console.log('Saving blur state to local storage'); const
        blurredCells=Array.from(document.querySelectorAll('td.blurred')).map(cell=> cell.className);
        localStorage.setItem('characterBlurStates', JSON.stringify(blurredCells));
        }

        // 블러 상태를 로컬 스토리지에서 복원
        function characterRestoreBlurState() {
        console.log('Restoring blur state from local storage');

        const blurredCells = JSON.parse(localStorage.getItem('characterBlurStates') || '[]');
        blurredCells.forEach(cellClass => {
        const cell = document.querySelector(`.${cellClass}`);
        if (cell) {
        cell.classList.add('blurred');
        cell.style.backgroundColor = '#f0f0f0'; // 배경 색 변경
        }
        });
        }

        // 필드 값 저장
        function characterSaveToLocalStorage() {
        console.log('Saving data to local storage');

        Object.values(characterCellClasses).flat().forEach(cellClass => {
        const input = document.querySelector(`.${cellClass}`);
        if (input) {
        localStorage.setItem(cellClass, input.value);
        console.log(`Saved ${cellClass} with value ${input.value}`);
        }
        });
        }

        // 필드 값 복원
        function characterLoadFromLocalStorage() {
        console.log('Check and Blur Function Called');

        const table = document.querySelector('table');
        const rows = table.getElementsByTagName('tr');

        // 블러 처리가 필요한 모든 셀 처리
        for (let i = 1; i < rows.length; i++) { const cells=rows[i].getElementsByTagName('td'); for (let j=0; j <
            cells.length; j++) { const cell=cells[j]; const cellText=cell.textContent.trim(); let shouldBlur=false; //
            무기와 자원의 블러 처리 Object.keys(weapons).forEach(weapon=> {
            if (cellText.includes(weapon)) {
            resources.forEach((resource, index) => {
            if (cellText.includes(resource)) {
            const inputValue = Number(document.querySelector(`.${weapons[weapon][index]}`).value);
            if (inputValue >= 5) {
            shouldBlur = true;
            }
            }
            });
            }
            });

            if (shouldBlur) {
            cell.classList.add('blurred');
            cell.style.backgroundColor = '#f0f0f0'; // 배경 색 변경
            console.log(`Cell ${cell.className} added blurred class and background color`);
            } else {
            cell.classList.remove('blurred');
            cell.style.backgroundColor = ''; // 배경 색 초기화
            console.log(`Cell ${cell.className} removed blurred class`);
            }
            }
            }

            // 블러 상태를 로컬 스토리지에 저장
            saveBlurState();
            }

            // 이벤트 리스너 추가
            Object.values(characterCellClasses).flat().forEach(cellClass => {
            const inputs = document.querySelectorAll(`.${cellClass}`);
            inputs.forEach(input => {
            if (input) {
            input.addEventListener('input', () => {
            characterCheckAndBlur();
            characterSaveToLocalStorage();
            });
            console.log(`Event listener added to input ${input.className}`);
            }
            });
            });

            // 페이지 로드 시 상태 복원
            document.addEventListener('DOMContentLoaded', () => {
            characterLoadFromLocalStorage();
            characterRestoreBlurState(); // 필드 값 복원 후 블러 상태 복원
            characterCheckAndBlur(); // 블러 상태를 다시 업데이트
            });

</body>

</html>